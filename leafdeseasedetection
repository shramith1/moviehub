<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Leaf Disease Detection</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>

/* ====== GLOBAL ====== */
body{
    margin:0;
    padding:0;
    font-family:Segoe UI, Arial;
    background:linear-gradient(to right,#0f2027,#203a43,#2c5364);
    color:#fff;
    text-align:center;
}

/* ====== MAIN CONTAINER ====== */
.container{
    width:90%;
    max-width:1000px;
    margin:30px auto;
    padding:20px;
    background:rgba(255,255,255,0.08);
    border-radius:15px;
}

/* ====== BUTTONS ====== */
button{
    padding:8px 15px;
    margin:5px;
    border:none;
    border-radius:20px;
    cursor:pointer;
    font-weight:600;
}

/* ====== CANVAS ====== */
#canvas{
    margin-top:20px;
    max-width:100%;
    background:#fff;
    border-radius:10px;
}

/* ====== RESULT GRID ====== */
.result-grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
    gap:15px;
    margin-top:20px;
}

.result-box{
    background:rgba(255,255,255,0.1);
    padding:15px;
    border-radius:10px;
}

#chart{
    margin-top:20px;
    background:#fff;
    border-radius:10px;
}

</style>
</head>

<body>

<h2>ðŸŒ¿ Leaf Disease Detection System</h2>

<div class="container">

<input type="file" id="imageInput" accept="image/*">
<button id="downloadBtn">Download Report</button>
<button onclick="window.print()">Print</button>

<canvas id="canvas"></canvas>

<div class="result-grid">
    <div class="result-box">
        <h3>Leaf Area</h3>
        <p id="area">-</p>
    </div>
    <div class="result-box">
        <h3>Status</h3>
        <p id="status">-</p>
    </div>
    <div class="result-box">
        <h3>Health %</h3>
        <p id="health">-</p>
    </div>
</div>

<canvas id="chart"></canvas>

</div>

<script>

const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const imageInput = document.getElementById("imageInput");
const areaText = document.getElementById("area");
const statusText = document.getElementById("status");
const healthText = document.getElementById("health");
const chartCanvas = document.getElementById("chart");

let chart;

// ===== IMAGE UPLOAD =====
imageInput.addEventListener("change", function(e){

    const file = e.target.files[0];
    if(!file) return;

    const reader = new FileReader();
    reader.onload = function(event){

        const img = new Image();
        img.onload = function(){

            canvas.width = img.width;
            canvas.height = img.height;
            ctx.drawImage(img,0,0);

            analyzeImage();
        };
        img.src = event.target.result;
    };
    reader.readAsDataURL(file);
});

// ===== IMAGE ANALYSIS =====
function analyzeImage(){

    const imgData = ctx.getImageData(0,0,canvas.width,canvas.height);
    const data = imgData.data;

    let totalPixels = canvas.width * canvas.height;
    let greenPixels = 0;
    let diseasePixels = 0;

    let red=0, green=0, blue=0, yellow=0, brown=0, other=0;

    for(let i=0;i<data.length;i+=4){

        let r=data[i];
        let g=data[i+1];
        let b=data[i+2];

        // Color classification
        if(g>r && g>b){
            green++; 
            greenPixels++;
        }
        else if(r>g && r>b){
            red++;
        }
        else if(b>r && b>g){
            blue++;
        }
        else if(r>150 && g>150){
            yellow++;
        }
        else if(r>100 && g<100){
            brown++;
        }
        else{
            other++;
        }

        // Disease highlight (red areas)
        if(r>120 && g<90 && b<90){
            diseasePixels++;
            data[i]=255;
            data[i+1]=0;
            data[i+2]=0;
        }
    }

    ctx.putImageData(imgData,0,0);

    let health = 100 - (diseasePixels/totalPixels)*100;
    if(health<0) health=0;

    areaText.innerText = greenPixels + " pixels";
    statusText.innerText = diseasePixels>500 ? "Disease Detected" : "Healthy";
    healthText.innerText = health.toFixed(2)+" %";

    drawChart(red,green,blue,yellow,brown,other);
}

// ===== CHART =====
function drawChart(r,g,b,y,br,o){

    if(chart) chart.destroy();

    chart = new Chart(chartCanvas,{
        type:"bar",
        data:{
            labels:["Red","Green","Blue","Yellow","Brown","Other"],
            datasets:[{
                data:[r,g,b,y,br,o]
            }]
        },
        options:{
            responsive:true,
            plugins:{legend:{display:false}}
        }
    });
}

// ===== DOWNLOAD REPORT =====
document.getElementById("downloadBtn").addEventListener("click", function(){

    if(canvas.width===0){
        alert("Upload image first!");
        return;
    }

    const report = `
    <h2>Leaf Disease Report</h2>
    <img src="${canvas.toDataURL()}" width="400">
    <p><b>Leaf Area:</b> ${areaText.innerText}</p>
    <p><b>Status:</b> ${statusText.innerText}</p>
    <p><b>Health:</b> ${healthText.innerText}</p>
    `;

    const blob = new Blob([report],{type:"text/html"});
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download="Leaf_Report.html";
    link.click();
});

</script>

</body>
</html>
